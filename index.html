<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auxiliar de Evolução Médica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --md-primary: #1976D2;
            --md-primary-light: #2196F3;
            --md-primary-dark: #1565C0;
            --md-secondary: #00BCD4;
            --md-surface: #FFFFFF;
            --md-background: #F5F5F5;
            --md-on-surface: rgba(0, 0, 0, 0.87);
            --md-on-background: rgba(0, 0, 0, 0.87);
            --md-on-primary: #FFFFFF;
            --md-text-secondary: rgba(0, 0, 0, 0.60);
            --md-divider: rgba(0, 0, 0, 0.12);
        }

        html.dark {
            --md-primary: #BB86FC;
            --md-primary-light: #985EFF;
            --md-primary-dark: #3700B3;
            --md-secondary: #03DAC6;
            --md-surface: #1E1E1E;
            --md-background: #121212;
            --md-on-surface: rgba(255, 255, 255, 0.87);
            --md-on-background: rgba(255, 255, 255, 0.87);
            --md-on-primary: #000000;
            --md-text-secondary: rgba(255, 255, 255, 0.60);
            --md-divider: rgba(255, 255, 255, 0.12);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--md-background);
            color: var(--md-on-background);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1024px;
        }

        .accordion-header,
        .js-accordion-header {
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        html.dark .accordion-header:hover,
        html.dark .js-accordion-header:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .accordion-content {
            transition: max-height 0.3s ease-out;
            overflow: hidden;
            border-color: var(--md-divider);
        }

        .chevron-icon {
            transition: transform 0.3s ease-in-out;
        }

        .rotate-180 {
            transform: rotate(180deg);
        }

        .form-input,
        .form-textarea,
        .form-select {
            border: none;
            border-bottom: 1px solid var(--md-divider);
            padding: 0.5rem 0.25rem;
            background-color: transparent;
            color: var(--md-on-background);
            transition: border-bottom-color 0.2s ease-in-out;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-bottom-color: var(--md-primary-light);
            box-shadow: 0 1px 0 0 var(--md-primary-light);
        }

        html.dark .form-input:focus,
        html.dark .form-textarea:focus,
        html.dark .form-select:focus {
            border-bottom-color: var(--md-secondary);
            box-shadow: 0 1px 0 0 var(--md-secondary);
        }

        html.dark .form-select {
            background-color: var(--md-surface);
            color: var(--md-on-background);
        }

        .form-checkbox {
            accent-color: var(--md-primary-light);
            margin-right: 0.5rem;
        }

        html.dark .form-checkbox {
            accent-color: var(--md-secondary);
        }

        .subsection-title {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--md-on-surface);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--md-divider);
            margin-bottom: 1.5rem;
        }

        .grid-container {
            display: grid;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .grid-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .grid-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        html.dark .bg-gray-50 {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .md-card {
            background-color: var(--md-surface);
            border-radius: 8px;
            box-shadow: 0px 2px 4px -1px rgba(0, 0, 0, 0.2),
                0px 4px 5px 0px rgba(0, 0, 0, 0.14),
                0px 1px 10px 0px rgba(0, 0, 0, 0.12);
            transition: background-color 0.3s ease;
        }

        .md-card-elevated {
            box-shadow: 0px 5px 5px -3px rgba(0, 0, 0, 0.2),
                0px 8px 10px 1px rgba(0, 0, 0, 0.14),
                0px 3px 14px 2px rgba(0, 0, 0, 0.12);
        }

        .md-button {
            background-color: var(--md-primary-light);
            color: var(--md-on-primary);
            border-radius: 4px;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .md-button:hover {
            background-color: var(--md-primary-dark);
            box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2),
                0px 6px 10px 0px rgba(0, 0, 0, 0.14),
                0px 1px 18px 0px rgba(0, 0, 0, 0.12);
        }

        .md-button-secondary {
            background-color: #6c757d;
        }

        .md-button-secondary:hover {
            background-color: #5a6268;
        }

        .md-button-tertiary {
            background-color: #4a5568;
        }

        .md-button-tertiary:hover {
            background-color: #2d3748;
        }

        .md-button:active {
            transform: scale(0.98);
        }

        .text-primary {
            color: var(--md-on-background);
        }

        .text-secondary {
            color: var(--md-text-secondary);
        }

        .text-blue-500 {
            color: var(--md-primary-light) !important;
        }

        .bg-blue-500 {
            background-color: var(--md-primary-light) !important;
        }

        .hover\:bg-blue-600:hover {
            background-color: var(--md-primary-dark) !important;
        }

        .focus\:ring-blue-500:focus {
            --tw-ring-color: var(--md-primary-light) !important;
        }

        html.dark .focus\:ring-blue-500:focus {
            --tw-ring-color: var(--md-secondary) !important;
        }

        html.dark .focus\:ring-offset-2:focus {
            --tw-ring-offset-color: var(--md-background) !important;
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div class="container mx-auto space-y-6 md:space-y-8">
        <header class="mb-4 flex justify-between items-center p-2">
            <div class="text-center flex-grow">
                <h1 class="text-3xl md:text-4xl font-bold text-primary">Auxiliar de Evolução Médica</h1>
                <p class="text-base md:text-lg text-secondary mt-1">Criado com ❤️ por @caiodeag</p>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" aria-label="Toggle dark mode">
                <i class="fas fa-moon text-xl text-secondary"></i>
            </button>
        </header>

        <main id="evolution-form" class="md-card p-4 md:p-8 space-y-4">
            <div id="accordion-container" class="space-y-4">

                <div class="md-card" data-print-section="Situação Geral e Anamnese">
                    <button class="js-accordion-header accordion-header w-full flex justify-between items-center p-4 md:p-5 text-left bg-md-surface hover:bg-gray-100 dark:hover:bg-opacity-5 rounded-lg" aria-expanded="true">
                        <div class="flex items-center space-x-4">
                            <i class="fas fa-user-md text-xl text-blue-500"></i>
                            <h2 class="text-lg md:text-xl font-medium text-primary">Situação Geral e Anamnese</h2>
                        </div>
                        <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                    </button>
                    <div class="accordion-content p-4 md:p-6 border-t">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="col-span-1 md:col-span-2">
                                <label class="font-medium text-secondary">Nome do Paciente:</label>
                                <input type="text" id="paciente_nome" placeholder="Nome completo do paciente" class="form-input w-full mt-1 printable" data-print-label="Nome do Paciente">
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Prontuário:</label>
                                <input type="text" id="paciente_prontuario" placeholder="Número do prontuário" class="form-input w-full mt-1 printable" data-print-label="Prontuário">
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Setor:</label>
                                <input type="text" id="setor" placeholder="Ex: CTI, Enfermaria" class="form-input w-full mt-1 printable" data-print-label="Setor">
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Leito:</label>
                                <input type="text" id="leito" placeholder="Ex: CTI 3" class="form-input w-full mt-1 printable" data-print-label="Leito">
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Evolução Clínica:</label>
                                <select id="evolucao-clinica" class="form-select w-full mt-1 printable" data-print-label="Evolução Clínica">
                                    <option value="">-- Selecione --</option>
                                    <option value="estável">Estável</option>
                                    <option value="mantendo o quadro">Mantendo o quadro</option>
                                    <option value="com melhora clínica">Com melhora clínica</option>
                                    <option value="com piora clínica">Com piora clínica</option>
                                    <option value="instável">Instável</option>
                                </select>
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Evolução Hemodinâmica:</label>
                                <select id="evolucao-hemo" class="form-select w-full mt-1 printable" data-print-label="Evolução Hemodinâmica">
                                    <option value="">-- Selecione --</option>
                                    <option value="estável">Estável</option>
                                    <option value="instável">Instável</option>
                                </select>
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Estado Geral:</label>
                                <select id="estado-geral" class="form-select w-full mt-1 printable" data-print-label="Estado Geral">
                                    <option value="">-- Selecione --</option>
                                    <option value="bom">Bom</option>
                                    <option value="regular">Regular</option>
                                    <option value="ruim">Ruim</option>
                                    <option value="grave">Grave</option>
                                </select>
                            </div>
                            <div>
                                <label class="font-medium text-secondary">Queixas nas 24h:</label>
                                <select id="queixas" class="form-select w-full mt-1 printable" data-print-label="Queixas nas 24h">
                                    <option value="">-- Selecione --</option>
                                    <option value="Sim">Sim</option>
                                    <option value="Não">Não</option>
                                </select>
                            </div>
                            <div id="queixas-obs-container" class="col-span-full hidden">
                                <label class="font-medium text-secondary">Descrição das queixas:</label>
                                <textarea id="queixas-obs" rows="1" class="form-textarea w-full mt-1 printable" data-print-label="Descrição das Queixas" placeholder="Ex: Refere dor abdominal em cólica"></textarea>
                            </div>
                            <div class="col-span-full grid grid-cols-2 lg:grid-cols-4 gap-6">
                                <div class="form-group-flex">
                                    <label class="font-medium text-secondary">Distermias:</label>
                                    <select id="distermias" class="form-select flex-1 printable" data-print-label="Distermias">
                                        <option value="">-- Sel --</option>
                                        <option value="Sim">Sim</option>
                                        <option value="Não">Não</option>
                                    </select>
                                </div>
                                <div class="form-group-flex">
                                    <label class="font-medium text-secondary">Disglicemias:</label>
                                    <select id="disglicemias" class="form-select flex-1 printable" data-print-label="Disglicemias">
                                        <option value="">-- Sel --</option>
                                        <option value="Sim">Sim</option>
                                        <option value="Não">Não</option>
                                    </select>
                                </div>
                                <div class="form-group-flex">
                                    <label class="font-medium text-secondary">Alt. de PA:</label>
                                    <select id="alt-pa" class="form-select flex-1 printable" data-print-label="Alterações de PA">
                                        <option value="">-- Sel --</option>
                                        <option value="Sim">Sim</option>
                                        <option value="Não">Não</option>
                                    </select>
                                </div>
                                <div class="form-group-flex">
                                    <label class="font-medium text-secondary">Alterações Lab:</label>
                                    <select id="alt-lab" class="form-select flex-1 printable" data-print-label="Alterações Laboratoriais">
                                        <option value="">-- Sel --</option>
                                        <option value="Sim">Sim</option>
                                        <option value="Não">Não</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-span-full mt-2">
                                <label class="font-medium text-secondary">Observações gerais (Anamnese):</label>
                                <textarea id="obs-gerais" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Observações Gerais (Anamnese)" placeholder="Ex: Paciente em oxigenoterapia por cateter nasal"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="md-card" data-print-section="Parâmetros Vitais e Suporte">
                    <button class="js-accordion-header accordion-header w-full flex justify-between items-center p-4 md:p-5 text-left bg-md-surface hover:bg-gray-100 dark:hover:bg-opacity-5 rounded-lg" aria-expanded="false">
                        <div class="flex items-center space-x-4">
                            <i class="fas fa-heart-pulse text-xl text-blue-500"></i>
                            <h2 class="text-lg md:text-xl font-medium text-primary">Parâmetros Vitais e Suporte</h2>
                        </div>
                        <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                    </button>
                    <div class="accordion-content border-t hidden">
                        <div data-print-subsection="Parâmetros Atuais">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Parâmetros Atuais</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">PA:</label>
                                        <input type="text" id="pa" placeholder="mmHg" class="form-input w-full mt-1 printable" data-print-label="PA">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">FC:</label>
                                        <input type="text" id="fc" placeholder="bpm" class="form-input w-full mt-1 printable" data-print-label="FC">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">FR:</label>
                                        <input type="text" id="fr" placeholder="irpm" class="form-input w-full mt-1 printable" data-print-label="FR">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Temp:</label>
                                        <input type="text" id="temp" placeholder="°C" class="form-input w-full mt-1 printable" data-print-label="Temperatura">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">SatO₂:</label>
                                        <input type="text" id="sato2" placeholder="%" class="form-input w-full mt-1 printable" data-print-label="SatO₂">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Dor (Escala 1-10):</label>
                                        <input type="text" id="dor-escala" placeholder="0 a 10" class="form-input w-full mt-1 printable" data-print-label="Dor (0-10)">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="font-medium text-secondary">Outras observações (Parâmetros Atuais):</label>
                                    <textarea id="parametros-obs" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Observações (Parâmetros)" placeholder="Ex: Mantendo boa saturação durante o banho no leito."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Suporte e Balanço">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Suporte e Balanço</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Ventilação:</label>
                                        <select id="suporte-vent" class="form-select w-full mt-1 printable" data-print-label="Suporte Ventilatório">
                                            <option value="">-- Selecione --</option>
                                            <option value="Ar Ambiente">Ar Ambiente</option>
                                            <option value="Cateter Nasal">Cateter Nasal</option>
                                            <option value="Máscara de O2">Máscara de O2</option>
                                            <option value="Máscara com Reservatório">Máscara com Reservatório</option>
                                            <option value="VNI">VNI</option>
                                            <option value="VM">VM</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="suporte-vent-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="suporte-vent-outro" class="form-input w-full mt-1" placeholder="Detalhe do suporte ventilatório (outro)">
                                    </div>
                                    <div id="vm-parameters-container" class="col-span-full hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4 p-4 md-card bg-gray-50">
                                        <h4 class="col-span-full text-lg font-semibold text-primary mb-2">Parâmetros de Ventilação Mecânica</h4>
                                        <div>
                                            <label class="font-medium text-secondary">Modo VM:</label>
                                            <input type="text" id="vm-modo" placeholder="Ex: VCV, PCV, PSV" class="form-input w-full mt-1 printable" data-print-label="Modo VM">
                                        </div>
                                        <div>
                                            <label class="font-medium text-secondary">FiO₂:</label>
                                            <input type="text" id="vm-fio2" placeholder="%" class="form-input w-full mt-1 printable" data-print-label="FiO₂">
                                        </div>
                                        <div>
                                            <label class="font-medium text-secondary">PEEP:</label>
                                            <input type="text" id="vm-peep" placeholder="cmH₂O" class="form-input w-full mt-1 printable" data-print-label="PEEP">
                                        </div>
                                        <div>
                                            <label class="font-medium text-secondary">FR (Ventilador):</label>
                                            <input type="text" id="vm-fr" placeholder="irpm" class="form-input w-full mt-1 printable" data-print-label="FR (VM)">
                                        </div>
                                        <div>
                                            <label class="font-medium text-secondary">Pressão de Pico (Pva):</label>
                                            <input type="text" id="vm-pva" placeholder="cmH₂O" class="form-input w-full mt-1 printable" data-print-label="Pva">
                                        </div>
                                        <div>
                                            <label class="font-medium text-secondary">Volume Corrente (VT):</label>
                                            <input type="text" id="vm-tidal-vol" placeholder="mL" class="form-input w-full mt-1 printable" data-print-label="Volume Corrente (VT)">
                                        </div>
                                        <div class="col-span-full">
                                            <label class="font-medium text-secondary">Outros Parâmetros VM:</label>
                                            <textarea id="vm-outros-params" rows="1" class="form-textarea w-full mt-1 printable" data-print-label="Outros Parâmetros VM" placeholder="Ex: Plateau, I:E, Fluxo"></textarea>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Uso de DVA:</label>
                                        <select id="dva" class="form-select w-full mt-1 printable" data-print-label="Uso de DVA">
                                            <option value="">-- Selecione --</option>
                                            <option value="Sim">Sim</option>
                                            <option value="Não">Não</option>
                                        </select>
                                    </div>
                                    <div id="dva-obs-container" class="col-span-full hidden">
                                        <label class="font-medium text-secondary">Detalhes DVA:</label>
                                        <input type="text" id="dva-obs" placeholder="Ex: Noradrenalina 5 mcg/min" class="form-input w-full mt-1 printable" data-print-label="Detalhes DVA">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Dieta (Via):</label>
                                        <select id="dieta-tipo" class="form-select w-full mt-1 printable" data-print-label="Dieta (Via)">
                                            <option value="">-- Selecione --</option>
                                            <option value="Oral">Oral</option>
                                            <option value="Enteral">Enteral</option>
                                            <option value="Parenteral">Parenteral</option>
                                            <option value="Jejum">Jejum</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="dieta-tipo-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Dieta - Outro):</label>
                                        <input type="text" id="dieta-tipo-outro" class="form-input w-full mt-1" placeholder="Detalhe da via da dieta (outro)">
                                    </div>
                                    <div id="dieta-aceitacao-container">
                                        <label class="font-medium text-secondary">Aceitação da dieta:</label>
                                        <select id="dieta-aceitacao" class="form-select w-full mt-1 printable" data-print-label="Aceitação da Dieta">
                                            <option value="">-- Selecione --</option>
                                            <option value="boa">Boa</option>
                                            <option value="regular">Regular</option>
                                            <option value="ruim">Ruim</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Diurese (Tipo):</label>
                                        <select id="diurese-tipo" class="form-select w-full mt-1 printable" data-print-label="Diurese (Tipo)">
                                            <option value="">-- Selecione --</option>
                                            <option value="espontânea">Espontânea</option>
                                            <option value="por Sonda Vesical de Demora">Por Sonda Vesical de Demora</option>
                                            <option value="Anúria/Oligúria">Anúria/Oligúria</option>
                                            <option value="Ausente">Ausente</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="diurese-tipo-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes Diurese:</label>
                                        <input type="text" id="diurese-tipo-outro" class="form-input w-full mt-1" placeholder="Detalhe do tipo de diurese (outro)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Diurese (Qtde):</label>
                                        <input type="text" id="diurese" placeholder="mL/24h" class="form-input w-full mt-1 printable" data-print-label="Diurese (mL/24h)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Evacuações (Tipo):</label>
                                        <select id="evacuacoes-tipo" class="form-select w-full mt-1 printable" data-print-label="Evacuações (Tipo)">
                                            <option value="">-- Selecione --</option>
                                            <option value="presentes e fisiológicas">Presentes e fisiológicas</option>
                                            <option value="diarreia">Diarreia</option>
                                            <option value="constipação">Constipação</option>
                                            <option value="melena">Melena</option>
                                            <option value="hematoquezia">Hematoquezia</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="evacuacoes-tipo-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes Evacuações:</label>
                                        <input type="text" id="evacuacoes-tipo-outro" class="form-input w-full mt-1" placeholder="Detalhe do tipo de evacuações (outro)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Evacuações (Qtde):</label>
                                        <input type="text" id="evacuacoes" placeholder="nº/24h" class="form-input w-full mt-1 printable" data-print-label="Evacuações (nº/24h)">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="font-medium text-secondary">Outras observações (Suporte e Balanço):</label>
                                    <textarea id="suporte-obs" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Observações (Suporte)" placeholder="Ex: Sonda enteral progredida, aguardando raio-x de controle."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Picos e Eventos nas 24h">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Picos e Eventos nas 24h</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Pico PA (mmHg):</label>
                                        <input type="text" id="pico-pa" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Pico PA">
                                        <input type="time" id="pico-pa-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Pico PA)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Queda PA (mmHg):</label>
                                        <input type="text" id="queda-pa" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Queda PA">
                                        <input type="time" id="queda-pa-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Queda PA)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Pico Temp (°C):</label>
                                        <input type="text" id="pico-temp" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Pico Temperatura">
                                        <input type="time" id="pico-temp-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Pico Temp.)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Queda Temp (°C):</label>
                                        <input type="text" id="queda-temp" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Queda Temperatura">
                                        <input type="time" id="queda-temp-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Queda Temp.)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Pico Glicêmico (mg/dL):</label>
                                        <input type="text" id="pico-glicemia" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Pico Glicêmico">
                                        <input type="time" id="pico-glicemia-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Pico Glic.)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Queda Glicêmica (mg/dL):</label>
                                        <input type="text" id="queda-glicemia" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Queda Glicêmica">
                                        <input type="time" id="queda-glicemia-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Queda Glic.)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Pico SatO₂ (%):</label>
                                        <input type="text" id="pico-sato2" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Pico SatO₂">
                                        <input type="time" id="pico-sato2-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Pico SatO₂)">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Queda SatO₂ (%):</label>
                                        <input type="text" id="queda-sato2" placeholder="Valor" class="form-input w-full mt-1 printable" data-print-label="Queda SatO₂">
                                        <input type="time" id="queda-sato2-hora" class="form-input w-full mt-1 printable" data-print-label="Hora (Queda SatO₂)">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="font-medium text-secondary">Outras observações de eventos:</label>
                                    <textarea id="eventos-obs" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Observações (Eventos)" placeholder="Ex: Apresentou episódio de vômito após dieta."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="md-card" data-print-section="Exame Físico">
                    <button class="js-accordion-header accordion-header w-full flex justify-between items-center p-4 md:p-5 text-left bg-md-surface hover:bg-gray-100 dark:hover:bg-opacity-5 rounded-lg" aria-expanded="false">
                        <div class="flex items-center space-x-4">
                            <i class="fas fa-stethoscope text-xl text-blue-500"></i>
                            <h2 class="text-lg md:text-xl font-medium text-primary">Exame Físico</h2>
                        </div>
                        <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                    </button>
                    <div class="accordion-content border-t hidden">
                        <div data-print-subsection="Geral">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Geral</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-4">
                                    <div>
                                        <label class="font-medium text-secondary">Aparência Geral:</label>
                                        <select id="ef-aparencia-geral" class="form-select mt-1 w-full printable" data-print-label="Aparência Geral">
                                            <option value="">-- Selecione --</option>
                                            <option value="boa">Boa</option>
                                            <option value="regular">Regular</option>
                                            <option value="ruim">Ruim</option>
                                            <option value="grave">Grave</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-aparencia-geral-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-aparencia-geral-outro" class="form-input w-full mt-1" placeholder="Ex: Cansado, apático">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Expressão Facialis / Fácies:</label>
                                        <select id="ef-facies" class="form-select mt-1 w-full printable" data-print-label="Fácies">
                                            <option value="">-- Selecione --</option>
                                            <option value="atípica">Atípica</option>
                                            <option value="dolorosa">Dolorosa</option>
                                            <option value="ansiosa">Ansiosa</option>
                                            <option value="calma">Calma</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-facies-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-facies-outro" class="form-input w-full mt-1" placeholder="Ex: De sofrimento, inexpressiva">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Sinais de Desconforto/Sofrimento:</label>
                                        <select id="ef-desconforto" class="form-select mt-1 w-full printable" data-print-label="Sinais de Desconforto">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="leves">Leves</option>
                                            <option value="moderados">Moderados</option>
                                            <option value="intensos">Intensos</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-desconforto-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-desconforto-outro" class="form-input w-full mt-1" placeholder="Ex: Dispneia, dor, agitação">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Contato / Interação:</label>
                                        <select id="ef-contato" class="form-select mt-1 w-full printable" data-print-label="Contato/Interação">
                                            <option value="">-- Selecione --</option>
                                            <option value="ativo e cooperativo">Ativo e cooperativo</option>
                                            <option value="retraído">Retraído</option>
                                            <option value="irritável">Irritável</option>
                                            <option value="apático">Apático</option>
                                            <option value="ausente">Ausente</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-contato-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-contato-outro" class="form-input w-full mt-1" placeholder="Ex: Responde a estímulos dolorosos">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Estado Nutricional:</label>
                                        <select id="ef-estado-nutricional" class="form-select mt-1 w-full printable" data-print-label="Estado Nutricional">
                                            <option value="">-- Selecione --</option>
                                            <option value="eutrófico">Eutrófico</option>
                                            <option value="desnutrido">Desnutrido</option>
                                            <option value="obeso">Obeso</option>
                                            <option value="caquético">Caquético</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-estado-nutricional-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Estado Nutricional):</label>
                                        <input type="text" id="ef-estado-nutricional-outro" class="form-input w-full mt-1" placeholder="Detalhe do estado nutricional">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Decúbito/Mobilidade:</label>
                                        <select id="ef-decubito" class="form-select mt-1 w-full printable" data-print-label="Decúbito/Mobilidade">
                                            <option value="">-- Selecione --</option>
                                            <option value="ativo no leito">Ativo no leito</option>
                                            <option value="restrito ao leito">Restrito ao leito</option>
                                            <option value="em decúbito dorsal">Em decúbito dorsal</option>
                                            <option value="em decúbito lateral direito">Em decúbito lateral direito</option>
                                            <option value="em decúbito lateral esquerdo">Em decúbito lateral esquerdo</option>
                                            <option value="deambula com auxílio">Deambula com auxílio</option>
                                            <option value="deambula sem auxílio">Deambula sem auxílio</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-decubito-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Decúbito/Mobilidade):</label>
                                        <input type="text" id="ef-decubito-outro" class="form-input w-full mt-1" placeholder="Detalhe do decúbito/mobilidade">
                                    </div>
                                    <div class="col-span-full">
                                        <label class="font-medium text-secondary">Dispositivos, Sondas, Cateteres ou Drenos:</label>
                                        <textarea id="ef-dispositivos" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Dispositivos" placeholder="Ex: Sonda vesical de demora, CVC em subclávia direita, dreno de tórax, acesso venoso periférico em MSE sem sinais flogísticos."></textarea>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-x-6 gap-y-2 mb-4 printable" data-print-label="Estado Geral" data-print-type="checkbox-group">
                                    <label class="flex items-center text-secondary"><input type="checkbox" id="ef-corado" class="form-checkbox"><span class="ml-1">Corado</span></label>
                                    <label class="flex items-center text-secondary"><input type="checkbox" id="ef-hidratado" class="form-checkbox"><span class="ml-1">Hidratado</span></label>
                                    <label class="flex items-center text-secondary"><input type="checkbox" id="ef-anictérico" class="form-checkbox"><span class="ml-1">Anictérico</span></label>
                                    <label class="flex items-center text-secondary"><input type="checkbox" id="ef-acianotico" class="form-checkbox"><span class="ml-1">Acianótico</span></label>
                                    <label class="flex items-center text-secondary"><input type="checkbox" id="ef-afebril" class="form-checkbox"><span class="ml-1">Afebril</span></label>
                                    <label class="flex items-center text-secondary"><input type="checkbox" id="ef-eupneico" class="form-checkbox"><span class="ml-1">Eupneico</span></label>
                                </div>
                                <textarea id="ef-geral-obs" rows="1" class="form-textarea w-full printable" data-print-label="Observações (Geral)" placeholder="Outras observações gerais"></textarea>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Neurológico">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Neurológico</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Nível de Consciência:</label>
                                        <select id="neuro-consciencia-ef" class="form-select mt-1 w-full printable" data-print-label="Nível de Consciência">
                                            <option value="">-- Selecione --</option>
                                            <option value="lúcido e orientado em tempo e espaço">Lúcido e orientado em tempo e espaço</option>
                                            <option value="confuso">Confuso</option>
                                            <option value="agitado">Agitado</option>
                                            <option value="desorientado">Desorientado</option>
                                            <option value="sonolento">Sonolento</option>
                                            <option value="obnubilado">Obnubilado</option>
                                            <option value="estuporoso">Estuporoso</option>
                                            <option value="em coma">Em coma</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="neuro-consciencia-ef-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="neuro-consciencia-ef-outro" class="form-input w-full mt-1" placeholder="Detalhe do nível de consciência">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Pupilas:</label>
                                        <select id="neuro-pupilas" class="form-select mt-1 w-full printable" data-print-label="Pupilas">
                                            <option value="">-- Selecione --</option>
                                            <option value="isocóricas e fotorreagentes">Isocóricas e fotorreagentes</option>
                                            <option value="lentamente fotorreagentes">Lentamente fotorreagentes</option>
                                            <option value="mióticas">Mióticas</option>
                                            <option value="midriáticas">Midriáticas</option>
                                            <option value="anisocóricas">Anisocóricas</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="neuro-pupilas-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="neuro-pupilas-outro" class="form-input w-full mt-1" placeholder="Detalhe das pupilas">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Pares Cranianos:</label>
                                        <select id="neuro-pares" class="form-select mt-1 w-full printable" data-print-label="Pares Cranianos">
                                            <option value="">-- Selecione --</option>
                                            <option value="preservados">Preservados</option>
                                            <option value="Alterados">Alterados</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="neuro-pares-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Pares):</label>
                                        <input type="text" id="neuro-pares-detalhes" class="form-input w-full mt-1 printable" data-print-label="Detalhes (Pares Cranianos)" placeholder="Descreva a alteração">
                                    </div>
                                    <div id="neuro-pares-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="neuro-pares-outro" class="form-input w-full mt-1" placeholder="Detalhe dos pares cranianos">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Força Motora:</label>
                                        <select id="neuro-forca-motora" class="form-select mt-1 w-full printable" data-print-label="Força Motora">
                                            <option value="">-- Selecione --</option>
                                            <option value="preservada nos 4 membros">Preservada nos 4 membros</option>
                                            <option value="diminuída globalmente">Diminuída globalmente</option>
                                            <option value="Paresia">Paresia</option>
                                            <option value="Plegia">Plegia</option>
                                            <option value="Hemiplegia">Hemiplegia</option>
                                            <option value="Tetraplegia">Tetraplegia</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="neuro-forca-motora-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Força):</label>
                                        <input type="text" id="neuro-forca-motora-detalhes" class="form-input w-full mt-1 printable" data-print-label="Detalhes (Força Motora)" placeholder="Localização e grau">
                                    </div>
                                    <div id="neuro-forca-motora-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="neuro-forca-motora-outro" class="form-input w-full mt-1" placeholder="Detalhe da força motora">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Sensibilidade:</label>
                                        <select id="neuro-sensibilidade" class="form-select mt-1 w-full printable" data-print-label="Sensibilidade">
                                            <option value="">-- Selecione --</option>
                                            <option value="preservada">Preservada</option>
                                            <option value="diminuída">Diminuída</option>
                                            <option value="alterada">Alterada</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="neuro-sensibilidade-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="neuro-sensibilidade-outro" class="form-input w-full mt-1" placeholder="Detalhe da sensibilidade">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Reflexos:</label>
                                        <select id="neuro-reflexos" class="form-select mt-1 w-full printable" data-print-label="Reflexos">
                                            <option value="">-- Selecione --</option>
                                            <option value="preservados">Preservados</option>
                                            <option value="com hiporreflexia">Com hiporreflexia</option>
                                            <option value="com arreflexia">Com arreflexia</option>
                                            <option value="com hiperreflexia">Com hiperreflexia</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="neuro-reflexos-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="neuro-reflexos-outro" class="form-input w-full mt-1" placeholder="Detalhe dos reflexos">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Sinais Meníngeos:</label>
                                        <select id="neuro-meningeos" class="form-select mt-1 w-full printable" data-print-label="Sinais Meníngeos">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="presentes">Presente</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Escore de Glasgow:</label>
                                        <input type="text" id="glasgow" placeholder="E, V, M" class="form-input w-full mt-1 printable" data-print-label="Glasgow">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Escala de RASS:</label>
                                        <select id="neuro-rass" class="form-select mt-1 w-full printable" data-print-label="RASS">
                                            <option value="">-- Selecione --</option>
                                            <option value="+4 (Combativo)">+4 (Combativo)</option>
                                            <option value="+3 (Muito Agitado)">+3 (Muito Agitado)</option>
                                            <option value="+2 (Agitado)">+2 (Agitado)</option>
                                            <option value="+1 (Inquieto)">+1 (Inquieto)</option>
                                            <option value="0 (Alerta e Calmo)">0 (Alerta e Calmo)</option>
                                            <option value="-1 (Sonolento)">-1 (Sonolento)</option>
                                            <option value="-2 (Sedação Leve)">-2 (Sedação Leve)</option>
                                            <option value="-3 (Sedação Moderada)">-3 (Sedação Moderada)</option>
                                            <option value="-4 (Sedação Profunda)">-4 (Sedação Profunda)</option>
                                            <option value="-5 (Não Despertável)">-5 (Não Despertável)</option>
                                        </select>
                                    </div>
                                </div>
                                <textarea id="neuro-obs" rows="2" class="form-textarea w-full mt-4 printable" data-print-label="Observações (Neurológico)" placeholder="Outras observações neurológicas"></textarea>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Cardiovascular">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Cardiovascular</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Ritmo:</label>
                                        <select id="cardio-ritmo" class="form-select mt-1 w-full printable" data-print-label="Ritmo Cardíaco">
                                            <option value="">-- Selecione --</option>
                                            <option value="regular">Regular</option>
                                            <option value="irregular">Irregular</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="cardio-ritmo-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="cardio-ritmo-outro" class="form-input w-full mt-1" placeholder="Detalhe do ritmo">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Bulhas:</label>
                                        <select id="cardio-bulhas" class="form-select mt-1 w-full printable" data-print-label="Bulhas">
                                            <option value="">-- Selecione --</option>
                                            <option value="normofonéticas">Normofonéticas</option>
                                            <option value="hipofonéticas">Hipofonéticas</option>
                                            <option value="hiperfonéticas">Hiperfonéticas</option>
                                            <option value="desdobradas">Desdobradas</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="cardio-bulhas-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Bulhas):</label>
                                        <input type="text" id="cardio-bulhas-outro" class="form-input w-full mt-1" placeholder="Detalhe das bulhas">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Tempos:</label>
                                        <select id="cardio-bulhas-tempos" class="form-select mt-1 w-full printable" data-print-label="Tempos">
                                            <option value="">-- Selecione --</option>
                                            <option value="em 2 tempos">Em 2 tempos</option>
                                            <option value="em 3 tempos">Em 3 tempos</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="cardio-bulhas-tempos-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Tempos):</label>
                                        <input type="text" id="cardio-bulhas-tempos-outro" class="form-input w-full mt-1" placeholder="Detalhe dos tempos">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Sopros:</label>
                                        <select id="cardio-sopros" class="form-select mt-1 w-full printable" data-print-label="Sopros">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="sopro sistólico ejetivo">Sopro sistólico ejetivo</option>
                                            <option value="sopro sistólico regurgitativo">Sopro sistólico regurgitativo</option>
                                            <option value="sopro diastólico">Sopro diastólico</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="cardio-sopros-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Sopros):</label>
                                        <input type="text" id="cardio-sopros-detalhes" class="form-input w-full mt-1 printable" data-print-label="Detalhes (Sopros)" placeholder="Foco, irradiação, intensidade">
                                    </div>
                                    <div id="cardio-sopros-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="cardio-sopros-outro" class="form-input w-full mt-1" placeholder="Detalhe dos sopros">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Turgência Jugular:</label>
                                        <select id="cardio-tj" class="form-select mt-1 w-full printable" data-print-label="Turgência Jugular">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausente">Ausente</option>
                                            <option value="presente">Presente</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="cardio-tj-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="cardio-tj-outro" class="form-input w-full mt-1" placeholder="Detalhe da turgência jugular">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Ictus:</label>
                                        <select id="cardio-ictus" class="form-select mt-1 w-full printable" data-print-label="Ictus">
                                            <option value="">-- Selecione --</option>
                                            <option value="não palpável">Não palpável</option>
                                            <option value="palpável">Palpável</option>
                                            <option value="desviado">Desviado</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="cardio-ictus-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="cardio-ictus-outro" class="form-input w-full mt-1" placeholder="Detalhe do ictus">
                                    </div>
                                </div>
                                <textarea id="ef-cardio-obs" rows="2" class="form-textarea w-full mt-4 printable" data-print-label="Observações (Cardiovascular)" placeholder="Outras observações cardiovasculares"></textarea>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Respiratório">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Respiratório</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Padrão Respiratório:</label>
                                        <select id="resp-padrao" class="form-select mt-1 w-full printable" data-print-label="Padrão Respiratório">
                                            <option value="">-- Selecione --</option>
                                            <option value="eupnéico">Eupnéico</option>
                                            <option value="taquipneico">Taquipneico</option>
                                            <option value="bradipneico">Bradipneico</option>
                                            <option value="hiperpneico">Hiperpneico</option>
                                            <option value="Kussmaul">Kussmaul</option>
                                            <option value="Cheyne-Stokes">Cheyne-Stokes</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="resp-padrao-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="resp-padrao-outro" class="form-input w-full mt-1" placeholder="Detalhe do padrão">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Ausculta Pulmonar:</label>
                                        <select id="ausculta-resp" class="form-select mt-1 w-full printable" data-print-label="Ausculta Pulmonar">
                                            <option value="">-- Selecione --</option>
                                            <option value="murmúrio vesicular presente bilateralmente">Murmúrio vesicular presente bilateralmente</option>
                                            <option value="murmúrio vesicular diminuído">Murmúrio vesicular diminuído</option>
                                            <option value="murmúrio vesicular abolido">Murmúrio vesicular abolido</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ausculta-resp-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ausculta-resp-outro" class="form-input w-full mt-1" placeholder="Detalhe da ausculta pulmonar">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Ruídos Adventícios:</label>
                                        <select id="ra-resp" class="form-select mt-1 w-full printable" data-print-label="Ruídos Adventícios">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="crepitações">Crepitações</option>
                                            <option value="estertores bolhosos">Estertores bolhosos</option>
                                            <option value="sibilos">Sibilos</option>
                                            <option value="roncos">Roncos</option>
                                            <option value="atrito pleural">Atrito pleural</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ra-resp-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Ruídos):</label>
                                        <input type="text" id="ra-resp-detalhes" class="form-input w-full mt-1 printable" data-print-label="Detalhes (Ruídos)" placeholder="Localização do ruído">
                                    </div>
                                    <div id="ra-resp-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ra-resp-outro" class="form-input w-full mt-1" placeholder="Detalhe dos ruídos adventícios">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Dispneia:</label>
                                        <select id="ef-resp-dispneia" class="form-select mt-1 w-full printable" data-print-label="Dispneia">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausente">Ausente</option>
                                            <option value="aos grandes esforços">Aos grandes esforços</option>
                                            <option value="aos médios esforços">Aos médios esforços</option>
                                            <option value="aos pequenos esforços">Aos pequenos esforços</option>
                                            <option value="em repouso">Em repouso</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-resp-dispneia-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-resp-dispneia-outro" class="form-input w-full mt-1" placeholder="Detalhe da dispneia">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Tosse:</label>
                                        <select id="ef-resp-tosse-geral" class="form-select mt-1 w-full printable" data-print-label="Tosse">
                                            <option value="">-- Selecione --</option>
                                            <option value="Sim">Sim</option>
                                            <option value="Não">Não</option>
                                        </select>
                                    </div>
                                    <div id="ef-resp-tosse-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Tipo de Tosse:</label>
                                        <select id="ef-resp-tosse" class="form-select mt-1 w-full printable" data-print-label="Tipo de Tosse">
                                            <option value="">-- Selecione --</option>
                                            <option value="seca">Seca</option>
                                            <option value="produtiva">Produtiva</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-resp-tosse-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-resp-tosse-outro" class="form-input w-full mt-1" placeholder="Ex: Expectoração hialina, etc.">
                                    </div>
                                </div>
                                <textarea id="ef-resp-obs" rows="2" class="form-textarea w-full mt-4 printable" data-print-label="Observações (Respiratório)" placeholder="Outras observações respiratórias"></textarea>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Abdominal">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Abdominal</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Forma:</label>
                                        <select id="ef-abd-forma" class="form-select mt-1 w-full printable" data-print-label="Forma Abdominal">
                                            <option value="">-- Selecione --</option>
                                            <option value="plano">Plano</option>
                                            <option value="globoso">Globoso</option>
                                            <option value="semigloboso">Semigloboso</option>
                                            <option value="escavado">Escavado</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-abd-forma-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-abd-forma-outro" class="form-input w-full mt-1" placeholder="Detalhe da forma abdominal">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Consistência:</label>
                                        <select id="ef-abd-consistencia" class="form-select mt-1 w-full printable" data-print-label="Consistência Abdominal">
                                            <option value="">-- Selecione --</option>
                                            <option value="flácido">Flácido</option>
                                            <option value="depressível">Depressível</option>
                                            <option value="tenso">Tenso</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-abd-consistencia-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-abd-consistencia-outro" class="form-input w-full mt-1" placeholder="Detalhe da consistência">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Dor à Palpação:</label>
                                        <select id="ef-abd-dor" class="form-select mt-1 w-full printable" data-print-label="Dor à Palpação">
                                            <option value="">-- Selecione --</option>
                                            <option value="indolor">Indolor</option>
                                            <option value="doloroso">Doloroso</option>
                                            <option value="com dor à descompressão brusca">Com dor à descompressão brusca</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-abd-dor-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-abd-dor-outro" class="form-input w-full mt-1" placeholder="Detalhe da dor à palpação">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Visceromegalias:</label>
                                        <select id="ef-abd-viscero" class="form-select mt-1 w-full printable" data-print-label="Visceromegalias">
                                            <option value="">-- Selecione --</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="hepatomegalia">Hepatomegalia</option>
                                            <option value="esplenomegalia">Esplenomegalia</option>
                                            <option value="massa palpável">Massa palpável</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-abd-viscero-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-abd-viscero-outro" class="form-input w-full mt-1" placeholder="Detalhe de visceromegalias">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Ruídos Hidroaéreos:</label>
                                        <select id="ef-abd-sons" class="form-select mt-1 w-full printable" data-print-label="Ruídos Hidroaéreos">
                                            <option value="">-- Selecione --</option>
                                            <option value="presentes">Presentes</option>
                                            <option value="aumentados">Aumentados</option>
                                            <option value="diminuídos">Diminuídos</option>
                                            <option value="ausentes">Ausentes</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="ef-abd-sons-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="ef-abd-sons-outro" class="form-input w-full mt-1" placeholder="Detalhe dos sons abdominais">
                                    </div>
                                </div>
                                <textarea id="ef-abd-obs" rows="2" class="form-textarea w-full mt-4 printable" data-print-label="Observações (Abdominal)" placeholder="Outras observações abdominais"></textarea>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Pele e Periférico">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Pele e Periférico</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid-container">
                                    <div>
                                        <label class="font-medium text-secondary">Temperatura:</label>
                                        <select id="pele-temp" class="form-select mt-1 w-full printable" data-print-label="Temperatura (Pele)">
                                            <option value="">-- Selecione --</option>
                                            <option value="aquecidas">Aquecidas</option>
                                            <option value="frias">Frias</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="pele-temp-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="pele-temp-outro" class="form-input w-full mt-1" placeholder="Detalhe da temperatura">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Turgor:</label>
                                        <select id="pele-turgor" class="form-select mt-1 w-full printable" data-print-label="Turgor">
                                            <option value="">-- Selecione --</option>
                                            <option value="preservado">Preservado</option>
                                            <option value="diminuído">Diminuído</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="pele-turgor-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="pele-turgor-outro" class="form-input w-full mt-1" placeholder="Detalhe do turgor">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Edema:</label>
                                        <select id="pele-edema" class="form-select mt-1 w-full printable" data-print-label="Edema">
                                            <option value="">-- Selecione --</option>
                                            <option value="Presente">Presente</option>
                                            <option value="Ausente">Ausente</option>
                                        </select>
                                    </div>
                                    <div id="pele-edema-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Edema):</label>
                                        <input type="text" id="pele-edema-detalhes" class="form-input w-full mt-1 printable" data-print-label="Detalhes (Edema)" placeholder="Ex: +2/4 em MMII">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Perf. Capilar:</label>
                                        <select id="pele-tec" class="form-select mt-1 w-full printable" data-print-label="Perfusão Capilar">
                                            <option value="">-- Selecione --</option>
                                            <option value="< 3s">&lt; 3s</option>
                                            <option value="> 3s">&gt; 3s</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="pele-tec-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="pele-tec-outro" class="form-input w-full mt-1" placeholder="Detalhe da perfusão capilar">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Pulsos:</label>
                                        <select id="pele-pulsos" class="form-select mt-1 w-full printable" data-print-label="Pulsos">
                                            <option value="">-- Selecione --</option>
                                            <option value="simétricos e cheios">Simétricos e cheios</option>
                                            <option value="diminuídos">Diminuídos</option>
                                            <option value="filiformes">Filiformes</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="pele-pulsos-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="pele-pulsos-outro" class="form-input w-full mt-1" placeholder="Detalhe dos pulsos">
                                    </div>
                                    <div>
                                        <label class="font-medium text-secondary">Integridade da pele:</label>
                                        <select id="pele-integridade" class="form-select mt-1 w-full printable" data-print-label="Integridade da Pele">
                                            <option value="">-- Selecione --</option>
                                            <option value="íntegra">Íntegra</option>
                                            <option value="com icterícia">Com icterícia</option>
                                            <option value="com cianose">Com cianose</option>
                                            <option value="Úlcera de Pressão">Úlcera de Pressão</option>
                                            <option value="Com Lesões">Com Lesões</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                    <div id="pele-integridade-detalhes-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes (Pele):</label>
                                        <input type="text" id="pele-integridade-detalhes" class="form-input w-full mt-1 printable" data-print-label="Detalhes (Integridade da Pele)" placeholder="Descreva as lesões/achados">
                                    </div>
                                    <div id="pele-integridade-outro-container" class="hidden">
                                        <label class="font-medium text-secondary">Detalhes:</label>
                                        <input type="text" id="pele-integridade-outro" class="form-input w-full mt-1" placeholder="Detalhe da integridade da pele">
                                    </div>
                                </div>
                                <textarea id="pele-obs" rows="2" class="form-textarea w-full mt-4 printable" data-print-label="Observações (Pele)" placeholder="Outras observações de pele e extremidades"></textarea>
                            </div>
                        </div>

                        <div class="border-t border-[var(--md-divider)]" data-print-subsection="Outro Sistema">
                            <button class="js-accordion-header w-full flex justify-between items-center text-left p-4" aria-expanded="false">
                                <span class="text-lg font-medium text-primary">Outro Sistema</span>
                                <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                            </button>
                            <div class="accordion-content hidden p-4 border-t border-[var(--md-divider)]">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="ef-outro-sistema-nome" class="font-medium text-secondary">Sistema:</label>
                                        <input type="text" id="ef-outro-sistema-nome" placeholder="Ex: Osteomuscular" class="form-input w-full mt-1 printable" data-print-label="Outro Sistema">
                                    </div>
                                    <div class="col-span-full">
                                        <label for="ef-outro-sistema-descricao" class="font-medium text-secondary">Descrição do exame físico:</label>
                                        <textarea id="ef-outro-sistema-descricao" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Descrição (Outro Sistema)" placeholder="Descreva os achados do exame físico para o sistema informado."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="md-card" data-print-section="Intercorrências e Condutas">
                    <button class="js-accordion-header accordion-header w-full flex justify-between items-center p-4 md:p-5 text-left bg-md-surface hover:bg-gray-100 dark:hover:bg-opacity-5 rounded-lg" aria-expanded="false">
                        <div class="flex items-center space-x-4">
                            <i class="fas fa-file-medical-alt text-xl text-blue-500"></i>
                            <h2 class="text-lg md:text-xl font-medium text-primary">Intercorrências e Condutas</h2>
                        </div>
                        <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                    </button>
                    <div class="accordion-content p-4 md:p-6 border-t hidden space-y-4">
                        <div>
                            <label class="font-medium text-secondary">Intercorrências clínicas:</label>
                            <textarea id="intercorrencias" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Intercorrências Clínicas" placeholder="Ex: Intercorrência de pico hipertensivo"></textarea>
                        </div>
                        <div>
                            <label class="font-medium text-secondary">Ajustes terapêuticos / prescrições:</label>
                            <textarea id="ajustes" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Ajustes Terapêuticos" placeholder="Ex: Ajustado analgésico, iniciado antibiótico"></textarea>
                        </div>
                    </div>
                </div>

                <div class="md-card" data-print-section="Exames e Resultados">
                    <button class="js-accordion-header accordion-header w-full flex justify-between items-center p-4 md:p-5 text-left bg-md-surface hover:bg-gray-100 dark:hover:bg-opacity-5 rounded-lg" aria-expanded="false">
                        <div class="flex items-center space-x-4">
                            <i class="fas fa-vial text-xl text-blue-500"></i>
                            <h2 class="text-lg md:text-xl font-medium text-primary">Exames e Resultados</h2>
                        </div>
                        <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                    </button>
                    <div class="accordion-content p-4 md:p-6 border-t hidden space-y-4">
                        <div>
                            <label class="font-medium text-secondary">Exames Laboratoriais:</label>
                            <textarea id="exames-lab" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Exames Laboratoriais" placeholder="Ex: Hemograma, função renal, eletrólitos, etc."></textarea>
                        </div>
                        <div>
                            <label class="font-medium text-secondary">Exames de Imagem:</label>
                            <textarea id="exames-imagem" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Exames de Imagem" placeholder="Ex: Raio-X de tórax, TC de abdome, etc."></textarea>
                        </div>
                        <div>
                            <label class="font-medium text-secondary">Outros Exames:</label>
                            <textarea id="exames-outros" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Outros Exames" placeholder="Ex: ECG, gasometria, etc."></textarea>
                        </div>
                    </div>
                </div>

                <div class="md-card" data-print-section="Conduta e Planejamento">
                    <button class="js-accordion-header accordion-header w-full flex justify-between items-center p-4 md:p-5 text-left bg-md-surface hover:bg-gray-100 dark:hover:bg-opacity-5 rounded-lg" aria-expanded="false">
                        <div class="flex items-center space-x-4">
                            <i class="fas fa-clipboard-list text-xl text-blue-500"></i>
                            <h2 class="text-lg md:text-xl font-medium text-primary">Conduta e Planejamento</h2>
                        </div>
                        <i class="fas fa-chevron-down chevron-icon text-secondary"></i>
                    </button>
                    <div class="accordion-content p-4 md:p-6 border-t hidden space-y-4">
                        <div>
                            <label class="font-medium text-secondary">Conduta para as próximas 24 horas:</label>
                            <textarea id="conduta" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Conduta" placeholder="Ex: Manter conduta, reavaliar em 24h."></textarea>
                        </div>
                        <div>
                            <label class="font-medium text-secondary">Outras considerações:</label>
                            <textarea id="planejamento" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Planejamento" placeholder="Ex: Solicitar avaliação da fonoaudiologia, considerar retirada de acesso venoso central amanhã."></textarea>
                        </div>
                        <div>
                            <label class="font-medium text-secondary">Profilaxias (TVP/TEV, Úlcera de estresse):</label>
                            <textarea id="profilaxias" rows="2" class="form-textarea w-full mt-1 printable" data-print-label="Profilaxias" placeholder="Ex: TVP com Enoxaparina 40mg SC 1x/dia, Úlcera de estresse com Pantoprazol 40mg EV 1x/dia."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <section class="md-card p-4 md:p-8">
            <div class="flex items-center space-x-4 mb-4">
                <i class="fas fa-magic-sparkles text-xl text-blue-500"></i>
                <h2 class="text-xl md:text-2xl font-semibold text-primary">Resumo Automático</h2>
            </div>
            <div class="generated-summary text-secondary" id="summary-output" style="white-space: pre-wrap; text-align: justify;">
                Comece a preencher os campos para gerar o resumo.
            </div>
            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                <button id="copy-btn" class="w-full flex items-center justify-center px-4 py-3 md-button font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-transform transform active:scale-[0.98]">
                    <i class="fas fa-copy mr-2"></i>
                    Copiar Resumo
                </button>
                <button id="print-btn" class="w-full flex items-center justify-center px-4 py-3 md-button md-button-secondary font-medium focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-transform transform active:scale-[0.98]">
                    <i class="fas fa-print mr-2"></i>
                    Gerar Impressão
                </button>
                <button id="download-blank-btn" class="w-full flex items-center justify-center px-4 py-3 md-button md-button-tertiary font-medium focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-offset-2 transition-transform transform active:scale-[0.98]">
                    <i class="fas fa-file-pdf mr-2"></i>
                    Baixar Formulário em Branco
                </button>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('evolution-form');

            const getInputValue = id => document.getElementById(id)?.value.trim() || '';
            const getSelectValue = id => document.getElementById(id)?.value || '';
            const getCheckboxStatus = id => document.getElementById(id)?.checked || false;

            function showHide(elementId, show) {
                const element = document.getElementById(elementId);
                if (!element) return;
                if (show) {
                    element.classList.remove('hidden');
                } else {
                    element.classList.add('hidden');
                    element.querySelectorAll('input, textarea, select').forEach(input => {
                        if (input.type === 'checkbox' || input.type === 'radio') {
                            input.checked = false;
                        } else if (input.tagName === 'SELECT') {
                            input.value = '';
                            input.dispatchEvent(new Event('change', {
                                bubbles: true
                            }));
                        } else {
                            input.value = '';
                        }
                    });
                }
            }

            const setupTheme = () => {
                const themeToggleBtn = document.getElementById('theme-toggle');
                const themeIcon = themeToggleBtn.querySelector('i');
                const userTheme = localStorage.getItem('theme');
                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;

                const applyTheme = (theme) => {
                    if (theme === 'dark') {
                        document.documentElement.classList.add('dark');
                        themeIcon.classList.replace('fa-moon', 'fa-sun');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                        themeIcon.classList.replace('fa-sun', 'fa-moon');
                        localStorage.setItem('theme', 'light');
                    }
                };

                if (userTheme === 'dark' || (!userTheme && systemTheme)) {
                    applyTheme('dark');
                } else {
                    applyTheme('light');
                }
                themeToggleBtn.addEventListener('click', () => {
                    applyTheme(document.documentElement.classList.contains('dark') ? 'light' : 'dark');
                });
            };

            const setupAccordions = () => {
                document.querySelectorAll('.js-accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const chevron = header.querySelector('.chevron-icon');
                        const isExpanded = header.getAttribute('aria-expanded') === 'true';

                        header.setAttribute('aria-expanded', !isExpanded);
                        content.classList.toggle('hidden');
                        chevron?.classList.toggle('rotate-180');
                    });
                });
            };

            const setupFormChangeHandlers = () => {
                form.addEventListener('change', (event) => {
                    const { id, value } = event.target;

                    if (document.getElementById(`${id}-outro-container`)) {
                        showHide(`${id}-outro-container`, value === 'outro');
                    }

                    switch (id) {
                        case 'queixas':
                            showHide('queixas-obs-container', value === 'Sim');
                            break;
                        case 'suporte-vent':
                            showHide('vm-parameters-container', value === 'VM');
                            break;
                        case 'dva':
                            showHide('dva-obs-container', value === 'Sim');
                            break;
                        case 'dieta-tipo':
                            showHide('dieta-aceitacao-container', value !== 'Jejum' && value !== '');
                            break;
                        case 'ef-resp-tosse-geral':
                            showHide('ef-resp-tosse-detalhes-container', value === 'Sim');
                            if (value !== 'Sim') showHide('ef-resp-tosse-outro-container', false);
                            break;
                        case 'pele-edema':
                            showHide('pele-edema-detalhes-container', value === 'Presente');
                            break;
                        case 'neuro-pares':
                            showHide('neuro-pares-detalhes-container', value === 'Alterados');
                            break;
                        case 'neuro-forca-motora':
                            showHide('neuro-forca-motora-detalhes-container', ['Paresia', 'Plegia'].includes(value));
                            break;
                        case 'cardio-sopros':
                            showHide('cardio-sopros-detalhes-container', value !== 'ausentes' && value !== '' && value !== 'outro');
                            break;
                        case 'ra-resp':
                            showHide('ra-resp-detalhes-container', value !== 'ausentes' && value !== '' && value !== 'outro');
                            break;
                        case 'pele-integridade':
                            showHide('pele-integridade-detalhes-container', ['Com Lesões', 'Úlcera de Pressão'].includes(value));
                            break;
                    }
                });
            };

            const setupSummaryGeneration = () => {
                let summaryTimeout;
                const updateSummary = () => {
                    clearTimeout(summaryTimeout);
                    summaryTimeout = setTimeout(generateSummary, 200);
                };
                form.addEventListener('input', updateSummary);
                form.addEventListener('change', updateSummary);
            };

            const setupActionButtons = () => {
                document.getElementById('copy-btn').addEventListener('click', () => {
                    const textToCopy = document.getElementById('summary-output').innerText;
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        const copyBtn = document.getElementById('copy-btn');
                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = `<i class="fas fa-check mr-2"></i> Copiado!`;
                        setTimeout(() => { copyBtn.innerHTML = originalText; }, 2000);
                    }).catch(err => console.error('Falha ao copiar texto:', err));
                });
                
                document.getElementById('print-btn').addEventListener('click', gerarImpressaoAutomatica);
                document.getElementById('download-blank-btn').addEventListener('click', gerarFormularioEmBranco);
            };
            
            setupTheme();
            setupAccordions();
            setupFormChangeHandlers();
            setupSummaryGeneration();
            setupActionButtons();

            generateSummary();
        });

        function generateSummary() {
            const getInputValue = id => document.getElementById(id)?.value.trim() || '';
            const getSelectValue = id => document.getElementById(id)?.value || '';
            const getCheckboxStatus = id => document.getElementById(id)?.checked || false;

            const joinWithCommasAndAnd = (arr) => {
                const filtered = arr.filter(Boolean);
                if (filtered.length === 0) return '';
                if (filtered.length === 1) return filtered[0];
                if (filtered.length === 2) return filtered.join(' e ');
                return `${filtered.slice(0, -1).join(', ')} e ${filtered.slice(-1)}`;
            };

            const joinWithCommasOrOr = (arr, useNem = false) => {
                const filtered = arr.filter(Boolean);
                if (filtered.length === 0) return '';
                if (filtered.length === 1) return filtered[0];
                const connector = useNem ? ' nem ' : ' ou ';
                if (filtered.length === 2) return filtered.join(connector);
                return `${filtered.slice(0, -1).join(', ')}${connector}${filtered.slice(-1)}`;
            };

            const processSelect = (selectId) => {
                const value = getSelectValue(selectId);
                if (value && value.toLowerCase() === 'outro') {
                    return getInputValue(`${selectId}-outro`) || 'outro (não especificado)';
                }
                return value;
            };

            const buildSentence = (parts) => {
                const sentence = parts.filter(p => p && p.trim() !== '').join(' ').trim();
                if (!sentence) return '';
                return sentence.charAt(0).toUpperCase() + sentence.slice(1) + '.';
            };

            const buildParagraph = (sentences) => sentences.filter(s => s && s.trim() !== '').join(' ');

            let finalResumo = '';
            const addSection = (title, content) => {
                if (content && content.trim() !== '') {
                    finalResumo += `${title.toUpperCase()}\n${content.trim()}\n\n`;
                }
            };
            
            const nomePaciente = getInputValue('paciente_nome');
            const prontuario = getInputValue('paciente_prontuario');
            let resumoHeader = (nomePaciente || prontuario) ? `Paciente: ${nomePaciente || 'Não informado'} - Prontuário: ${prontuario || 'Não informado'}\n\n` : '';

            let anamneseSentences = [];
            const setor = getInputValue('setor');
            const leito = getInputValue('leito');
            if (setor || leito) anamneseSentences.push(buildSentence([`Paciente em acompanhamento no(a) ${setor || 'setor não informado'}, leito ${leito || 'não informado'}`]));
            
            const evolucaoClinica = getSelectValue('evolucao-clinica');
            const evolucaoHemo = getSelectValue('evolucao-hemo');
            let evolutionParts = [];
            if (evolucaoClinica) evolutionParts.push(`clinicamente ${evolucaoClinica}`);
            if (evolucaoHemo) evolutionParts.push(`hemodinamicamente ${evolucaoHemo}`);
            if (evolutionParts.length > 0) anamneseSentences.push(buildSentence([`Encontra-se`, joinWithCommasAndAnd(evolutionParts)]));
            
            const estadoGeral = getSelectValue('estado-geral');
            if (estadoGeral) anamneseSentences.push(buildSentence([`Em ${estadoGeral} estado geral`]));

            const queixas = getSelectValue('queixas');
            if (queixas === 'Sim') {
                anamneseSentences.push(buildSentence([`Refere ${getInputValue('queixas-obs') || 'queixas não especificadas'} nas últimas 24h`]));
            } else if (queixas === 'Não') {
                anamneseSentences.push(buildSentence(['Nega queixas nas últimas 24h']));
            }
            
            let eventosPositivos = [], eventosNegativos = [];
            const eventosMap = { 'distermias': 'distermias', 'disglicemias': 'disglicemias', 'alt-pa': 'alterações de pressão arterial', 'alt-lab': 'alterações laboratoriais' };
            for (const [id, desc] of Object.entries(eventosMap)) {
                const value = getSelectValue(id);
                if (value === 'Sim') eventosPositivos.push(desc);
                else if (value === 'Não') eventosNegativos.push(desc);
            }
            if (eventosPositivos.length > 0) anamneseSentences.push(buildSentence(['Apresentou', joinWithCommasAndAnd(eventosPositivos)]));
            if (eventosNegativos.length > 0) anamneseSentences.push(buildSentence(['Não apresentou', joinWithCommasOrOr(eventosNegativos, true)]));

            const obsGeraisAnamnese = getInputValue('obs-gerais');
            if (obsGeraisAnamnese) anamneseSentences.push(buildSentence([obsGeraisAnamnese]));
            addSection('Situação Geral e Anamnese', buildParagraph(anamneseSentences));

            let paramsSentences = [];
            const vitais = [ getInputValue('pa') && `PA de ${getInputValue('pa')} mmHg`, getInputValue('fc') && `FC de ${getInputValue('fc')} bpm`, getInputValue('fr') && `FR de ${getInputValue('fr')} irpm`, getInputValue('temp') && `temperatura de ${getInputValue('temp')}°C`, getInputValue('sato2') && `SatO₂ de ${getInputValue('sato2')}%` ].filter(Boolean);
            if (vitais.length > 0) paramsSentences.push(buildSentence(['Apresenta-se com os seguintes parâmetros vitais:', joinWithCommasAndAnd(vitais)]));
            
            if (getInputValue('dor-escala')) paramsSentences.push(buildSentence([`Refere dor de intensidade ${getInputValue('dor-escala')}/10`]));
            if (getInputValue('parametros-obs')) paramsSentences.push(buildSentence([getInputValue('parametros-obs')]));

            const suporteVent = getSelectValue('suporte-vent');
            if (suporteVent) {
                if (suporteVent === 'VM') {
                    const vmParams = [ getInputValue('vm-modo') && `modo ${getInputValue('vm-modo')}`, getInputValue('vm-fio2') && `FiO₂ de ${getInputValue('vm-fio2')}%`, getInputValue('vm-peep') && `PEEP de ${getInputValue('vm-peep')} cmH₂O`, getInputValue('vm-fr') && `FR de ${getInputValue('vm-fr')} irpm`, getInputValue('vm-pva') && `Pva de ${getInputValue('vm-pva')} cmH₂O`, getInputValue('vm-tidal-vol') && `VT de ${getInputValue('vm-tidal-vol')} mL` ].filter(Boolean);
                    let vmSentence = `Em ventilação mecânica invasiva`;
                    if (vmParams.length > 0) vmSentence += `, com os seguintes parâmetros: ${joinWithCommasAndAnd(vmParams)}`;
                    if (getInputValue('vm-outros-params')) vmSentence += `, e ${getInputValue('vm-outros-params')}`;
                    paramsSentences.push(buildSentence([vmSentence]));
                } else {
                    paramsSentences.push(buildSentence([suporteVent === 'Ar Ambiente' ? 'Em ar ambiente' : `Em uso de suporte ventilatório com ${processSelect('suporte-vent')}`]));
                }
            }

            const dvaStatus = getSelectValue('dva');
            if (dvaStatus === 'Sim') paramsSentences.push(buildSentence([`Em uso de droga vasoativa (${getInputValue('dva-obs') || 'não especificada'})`]));
            else if (dvaStatus === 'Não') paramsSentences.push(buildSentence(['Sem uso de drogas vasoativas']));

            const dieta = processSelect('dieta-tipo');
            if (dieta) {
                if (dieta.toLowerCase() === 'jejum') paramsSentences.push(buildSentence(['Mantido em jejum']));
                else {
                    let dietaSentence = `Dieta via ${dieta}`;
                    const aceitacao = getSelectValue('dieta-aceitacao');
                    if (aceitacao) dietaSentence += `, com ${aceitacao} aceitação`;
                    paramsSentences.push(buildSentence([dietaSentence]));
                }
            }
            
            let eliminacoesParts = [];
            const diureseTipo = processSelect('diurese-tipo');
            if (diureseTipo) eliminacoesParts.push(`diurese ${diureseTipo}${getInputValue('diurese') ? ` com débito de ${getInputValue('diurese')} mL/24h` : ''}`);
            const evacuacoesTipo = processSelect('evacuacoes-tipo');
            if (evacuacoesTipo) eliminacoesParts.push(`evacuações ${evacuacoesTipo}${getInputValue('evacuacoes') ? `, ${getInputValue('evacuacoes')} episódios/24h` : ''}`);
            if (eliminacoesParts.length > 0) paramsSentences.push(buildSentence([`Eliminações fisiológicas presentes, com`, joinWithCommasAndAnd(eliminacoesParts)]));
            if (getInputValue('suporte-obs')) paramsSentences.push(buildSentence([getInputValue('suporte-obs')]));

            let picosEventos = [];
            const addPicoEvento = (label, valId, hId) => {
                if (getInputValue(valId)) picosEventos.push(`${label} de ${getInputValue(valId)}${getInputValue(hId) ? ` às ${getInputValue(hId)}h` : ''}`);
            };
            addPicoEvento('pico hipertensivo', 'pico-pa', 'pico-pa-hora');
            addPicoEvento('hipotensão', 'queda-pa', 'queda-pa-hora');
            addPicoEvento('pico febril', 'pico-temp', 'pico-temp-hora');
            addPicoEvento('hipotermia', 'queda-temp', 'queda-temp-hora');
            addPicoEvento('pico glicêmico', 'pico-glicemia', 'pico-glicemia-hora');
            addPicoEvento('hipoglicemia', 'queda-glicemia', 'queda-glicemia-hora');
            addPicoEvento('dessaturação', 'queda-sato2', 'queda-sato2-hora');
            if (picosEventos.length > 0) paramsSentences.push(buildSentence([`Nas últimas 24h, apresentou`, joinWithCommasAndAnd(picosEventos)]));
            if (getInputValue('eventos-obs')) paramsSentences.push(buildSentence(['Observações de eventos:', getInputValue('eventos-obs')]));
            
            addSection('Parâmetros Vitais e Suporte', buildParagraph(paramsSentences));

            let efSentences = [];

            // --- Geral ---
            let geralIntroParts = [];
            const aparenciaGeral = processSelect('ef-aparencia-geral');
            const estadoNutricional = processSelect('ef-estado-nutricional');
            const contato = processSelect('ef-contato');
            const decubito = processSelect('ef-decubito');

            if (aparenciaGeral) geralIntroParts.push(`em ${aparenciaGeral} aparência geral`);
            if (estadoNutricional) geralIntroParts.push(estadoNutricional);

            const adjEstadoGeral = [
                getCheckboxStatus('ef-corado') && 'corado(a)',
                getCheckboxStatus('ef-hidratado') && 'hidratado(a)',
                getCheckboxStatus('ef-anictérico') && 'anictérico(a)',
                getCheckboxStatus('ef-acianotico') && 'acianótico(a)',
                getCheckboxStatus('ef-afebril') && 'afebril',
                getCheckboxStatus('ef-eupneico') && 'eupnéico(a)'
            ].filter(Boolean);

            if (geralIntroParts.length > 0 || adjEstadoGeral.length > 0) {
                let firstPart = "Ao exame físico, paciente";
                let combinedGeral = joinWithCommasAndAnd(geralIntroParts.concat(adjEstadoGeral));
                if (combinedGeral) {
                    efSentences.push(buildSentence([firstPart, combinedGeral]));
                }
            }

            if (contato) efSentences.push(buildSentence([`Apresenta-se ${contato}`]));
            if (decubito) efSentences.push(buildSentence([`Mantém ${decubito}`]));

            const facies = processSelect('ef-facies');
            if (facies) efSentences.push(buildSentence([`Fácies ${facies}`]));

            const desconforto = processSelect('ef-desconforto');
            if (desconforto && desconforto !== 'ausentes') efSentences.push(buildSentence([`Com sinais de desconforto ${desconforto}`]));
            else if (desconforto === 'ausentes') efSentences.push(buildSentence([`Sem sinais de desconforto`]));

            const dispositivos = getInputValue('ef-dispositivos');
            if (dispositivos) efSentences.push(buildSentence(['Em uso dos seguintes dispositivos:', dispositivos]));

            const obsGeralEF = getInputValue('ef-geral-obs');
            if (obsGeralEF) efSentences.push(buildSentence([obsGeralEF]));


            // --- Neurológico ---
            let neuroStatements = [];
            const consciencia = processSelect('neuro-consciencia-ef');
            const rass = getSelectValue('neuro-rass');
            const glasgow = getInputValue('glasgow');

            let neuroConsciousnessParts = [];
            if (consciencia) neuroConsciousnessParts.push(consciencia);
            if (rass) neuroConsciousnessParts.push(`RASS ${rass}`);
            if (glasgow) neuroConsciousnessParts.push(`Glasgow ${glasgow}`);
            if (neuroConsciousnessParts.length > 0) {
                neuroStatements.push(buildSentence(['Neurológico: Paciente', joinWithCommasAndAnd(neuroConsciousnessParts)]));
            }

            const pupilas = processSelect('neuro-pupilas');
            if (pupilas) neuroStatements.push(buildSentence([`Pupilas ${pupilas}`]));

            const paresCranianos = getSelectValue('neuro-pares');
            if (paresCranianos === 'Alterados') {
                neuroStatements.push(buildSentence([`Pares cranianos com alterações (${getInputValue('neuro-pares-detalhes') || 'não especificado'})`]));
            } else if (paresCranianos) {
                neuroStatements.push(buildSentence([`Pares cranianos ${paresCranianos}`]));
            }

            const forcaMotora = getSelectValue('neuro-forca-motora');
            if (['Paresia', 'Plegia', 'Hemiplegia', 'Tetraplegia'].includes(forcaMotora)) {
                neuroStatements.push(buildSentence([`${forcaMotora} em ${getInputValue('neuro-forca-motora-detalhes') || 'local não especificado'}`]));
            } else if (forcaMotora) {
                neuroStatements.push(buildSentence([`Força motora ${forcaMotora}`]));
            }

            const sensibilidade = processSelect('neuro-sensibilidade');
            if (sensibilidade) neuroStatements.push(buildSentence([`Sensibilidade ${sensibilidade}`]));

            const reflexos = processSelect('neuro-reflexos');
            if (reflexos) neuroStatements.push(buildSentence([`Reflexos ${reflexos}`]));

            const meningeos = getSelectValue('neuro-meningeos');
            if (meningeos) neuroStatements.push(buildSentence([`Sinais meníngeos ${meningeos}`]));

            const neuroObs = getInputValue('neuro-obs');
            if (neuroObs) neuroStatements.push(buildSentence([neuroObs]));

            if (neuroStatements.length > 0) efSentences.push(buildParagraph(neuroStatements));


            // --- Cardiovascular ---
            let cardioStatements = [];
            const ritmoCardio = processSelect('cardio-ritmo');
            const bulhasCardio = processSelect('cardio-bulhas');
            const temposCardio = processSelect('cardio-bulhas-tempos');

            let auscultaCardioParts = [];
            if (ritmoCardio) auscultaCardioParts.push(`ritmo cardíaco ${ritmoCardio}`);
            if (bulhasCardio || temposCardio) auscultaCardioParts.push(`bulhas ${bulhasCardio || ''} ${temposCardio || ''}`.trim());
            if (auscultaCardioParts.length > 0) cardioStatements.push(buildSentence([`Ausculta cardíaca com`, joinWithCommasAndAnd(auscultaCardioParts)]));

            const soproValue = getSelectValue('cardio-sopros');
            if (soproValue === 'ausentes') cardioStatements.push(buildSentence(['Sem sopros audíveis']));
            else if (soproValue) cardioStatements.push(buildSentence([`Presença de ${processSelect('cardio-sopros')}${getInputValue('cardio-sopros-detalhes') ? ` (${getInputValue('cardio-sopros-detalhes')})` : ''}`]));

            const tj = processSelect('cardio-tj');
            if (tj && tj !== 'ausente') cardioStatements.push(buildSentence([`Turgência jugular ${tj}`]));
            else if (tj === 'ausente') cardioStatements.push(buildSentence(['Ausência de turgência jugular']));

            const ictus = processSelect('cardio-ictus');
            if (ictus) cardioStatements.push(buildSentence([`Ictus ${ictus}`]));

            const efCardioObs = getInputValue('ef-cardio-obs');
            if (efCardioObs) cardioStatements.push(buildSentence([efCardioObs]));

            if (cardioStatements.length > 0) efSentences.push(buildParagraph(cardioStatements));


            // --- Respiratório ---
            let respStatements = [];
            const padraoResp = processSelect('resp-padrao');
            if (padraoResp) respStatements.push(buildSentence([`Padrão respiratório ${padraoResp}`]));

            const auscultaResp = processSelect('ausculta-resp');
            const raResp = getSelectValue('ra-resp');

            let auscultaPulmonarParts = [];
            if (auscultaResp) auscultaPulmonarParts.push(auscultaResp);
            if (raResp === 'ausentes') auscultaPulmonarParts.push('sem ruídos adventícios');
            else if (raResp) auscultaPulmonarParts.push(`com ${processSelect('ra-resp')}${getInputValue('ra-resp-detalhes') ? ` em ${getInputValue('ra-resp-detalhes')}` : ''}`);

            if (auscultaPulmonarParts.length > 0) respStatements.push(buildSentence([`Ausculta pulmonar com`, joinWithCommasAndAnd(auscultaPulmonarParts)]));

            const dispneia = processSelect('ef-resp-dispneia');
            if (dispneia && dispneia !== 'ausente') respStatements.push(buildSentence([`Dispneia ${dispneia}`]));
            else if (dispneia === 'ausente') respStatements.push(buildSentence(['Ausência de dispneia']));

            const tosseGeral = getSelectValue('ef-resp-tosse-geral');
            if (tosseGeral === 'Não') respStatements.push(buildSentence(['Sem tosse']));
            else if (tosseGeral === 'Sim') respStatements.push(buildSentence([`Presença de tosse ${processSelect('ef-resp-tosse')}${getInputValue('ef-resp-tosse-outro') ? ` (${getInputValue('ef-resp-tosse-outro')})` : ''}`]));

            const efRespObs = getInputValue('ef-resp-obs');
            if (efRespObs) respStatements.push(buildSentence([efRespObs]));

            if (respStatements.length > 0) efSentences.push(buildParagraph(respStatements));


            // --- Abdominal ---
            let abdStatements = [];
            const abdForma = processSelect('ef-abd-forma');
            const abdConsistencia = processSelect('ef-abd-consistencia');
            const abdDor = processSelect('ef-abd-dor');

            let abdInitialParts = [];
            if (abdForma) abdInitialParts.push(abdForma);
            if (abdConsistencia) abdInitialParts.push(abdConsistencia);
            if (abdDor) abdInitialParts.push(abdDor);

            if (abdInitialParts.length > 0) abdStatements.push(buildSentence([`Abdome: ${joinWithCommasAndAnd(abdInitialParts)}`]));

            const viscero = processSelect('ef-abd-viscero');
            if (viscero === 'ausentes') abdStatements.push(buildSentence(['Sem visceromegalias palpáveis']));
            else if (viscero) abdStatements.push(buildSentence([`Com ${viscero}`]));

            const rha = processSelect('ef-abd-sons');
            if (rha) abdStatements.push(buildSentence([`Ruídos hidroaéreos ${rha}`]));

            const efAbdObs = getInputValue('ef-abd-obs');
            if (efAbdObs) abdStatements.push(buildSentence([efAbdObs]));

            if (abdStatements.length > 0) efSentences.push(buildParagraph(abdStatements));


            // --- Pele e Periférico ---
            let peleStatements = [];
            const peleTemp = processSelect('pele-temp');
            const pelePulsos = processSelect('pele-pulsos');
            if (peleTemp || pelePulsos) {
                let extremidadesDesc = [];
                if (peleTemp) extremidadesDesc.push(`extremidades ${peleTemp}`);
                if (pelePulsos) extremidadesDesc.push(`pulsos ${pelePulsos}`);
                if (extremidadesDesc.length > 0) peleStatements.push(buildSentence([joinWithCommasAndAnd(extremidadesDesc)]));
            }

            const tec = processSelect('pele-tec');
            if (tec) peleStatements.push(buildSentence([`Perfusão capilar ${tec}`]));

            const turgor = processSelect('pele-turgor');
            if (turgor) peleStatements.push(buildSentence([`Turgor ${turgor}`]));

            const peleEdema = getSelectValue('pele-edema');
            if (peleEdema === 'Ausente') peleStatements.push(buildSentence(['Ausência de edema']));
            else if (peleEdema === 'Presente') peleStatements.push(buildSentence([`Presença de edema (${getInputValue('pele-edema-detalhes') || 'não especificado'})`]));

            const integridadeValue = getSelectValue('pele-integridade');
            if (['Úlcera de Pressão', 'Com Lesões'].includes(integridadeValue)) {
                peleStatements.push(buildSentence([`Pele com ${integridadeValue.toLowerCase()} (${getInputValue('pele-integridade-detalhes') || 'não descrito'})`]));
            } else if (integridadeValue) {
                peleStatements.push(buildSentence([`Pele ${processSelect('pele-integridade')}`]));
            }

            const peleObs = getInputValue('pele-obs');
            if (peleObs) peleStatements.push(buildSentence([peleObs]));

            if (peleStatements.length > 0) efSentences.push(buildParagraph(peleStatements));


            // --- Outro Sistema ---
            if (getInputValue('ef-outro-sistema-nome') && getInputValue('ef-outro-sistema-descricao')) {
                efSentences.push(buildSentence([`${getInputValue('ef-outro-sistema-nome')}:`, getInputValue('ef-outro-sistema-descricao')]));
            }
            
            addSection('EXAME FÍSICO', buildParagraph(efSentences)); // Changed section title to uppercase for consistency

            const createDiscursiveSection = (title, items) => {
                const content = items.map(item => item.value ? buildSentence([item.label, item.value]) : null).filter(Boolean).join(' ');
                addSection(title, content);
            };
            createDiscursiveSection('INTERCORRÊNCIAS E CONDUTAS', [{ label: 'Intercorrências clínicas:', value: getInputValue('intercorrencias') }, { label: 'Ajustes terapêuticos:', value: getInputValue('ajustes') }]);
            createDiscursiveSection('EXAMES E RESULTADOS', [{ label: 'Exames laboratoriais:', value: getInputValue('exames-lab') }, { label: 'Exames de imagem:', value: getInputValue('exames-imagem') }, { label: 'Outros exames:', value: getInputValue('exames-outros') }]);
            createDiscursiveSection('CONDUTA E PLANEJAMENTO', [{ label: 'Conduta:', value: getInputValue('conduta') }, { label: 'Planejamento:', value: getInputValue('planejamento') }, { label: 'Profilaxias:', value: getInputValue('profilaxias') }]);

            const outputElement = document.getElementById('summary-output');
            outputElement.innerText = finalResumo.trim() ? resumoHeader + finalResumo.trim() : 'Comece a preencher os campos para gerar o resumo.';
        }

        function gerarImpressaoAutomatica() {
            const reportData = coletarDadosImpressao();
            const reportHtml = construirHtmlImpressao(reportData);
            abrirJanelaDeImpressao(reportHtml);
        }

        function gerarFormularioEmBranco() {
            const blankFormHtml = construirHtmlFormularioBranco();
            abrirJanelaDeImpressao(blankFormHtml);
        }

        function coletarDadosImpressao() {
            const sections = [];
            document.querySelectorAll('[data-print-section]').forEach(sectionEl => {
                const sectionData = { title: sectionEl.getAttribute('data-print-section'), subsections: [] };
                const subsections = sectionEl.querySelectorAll('[data-print-subsection]');
                if (subsections.length > 0) {
                    subsections.forEach(subEl => {
                        const subData = { title: subEl.getAttribute('data-print-subsection'), fields: [] };
                        subEl.querySelectorAll('.printable').forEach(fieldEl => processField(fieldEl, subData.fields));
                        if (subData.fields.length > 0) sectionData.subsections.push(subData);
                    });
                } else {
                    const defaultSubData = { title: '', fields: [] };
                    sectionEl.querySelectorAll('.printable').forEach(fieldEl => processField(fieldEl, defaultSubData.fields));
                    if (defaultSubData.fields.length > 0) sectionData.subsections.push(defaultSubData);
                }
                if (sectionData.subsections.length > 0) sections.push(sectionData);
            });
            
            const headerData = {
                nome: document.getElementById('paciente_nome').value,
                prontuario: document.getElementById('paciente_prontuario').value,
                setor: document.getElementById('setor').value,
                leito: document.getElementById('leito').value,
                data: new Date().toLocaleDateString('pt-BR'),
                hora: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
            };
            
            return { header: headerData, sections, summary: document.getElementById('summary-output').innerText };
        }

        function processField(fieldEl, fieldsArray) {
            if (fieldEl.offsetParent === null) return; // Only process visible fields for a filled print
            let value = '';
            const label = fieldEl.getAttribute('data-print-label');
            const type = fieldEl.getAttribute('data-print-type');

            if (['Nome do Paciente', 'Prontuário', 'Setor', 'Leito'].includes(label)) return;

            if (type === 'checkbox-group') {
                const checkedItems = [];
                fieldEl.querySelectorAll('input[type="checkbox"]:checked').forEach(item => {
                    const labelWrapper = item.closest('label');
                    if (labelWrapper) checkedItems.push(labelWrapper.innerText.trim());
                });
                value = checkedItems.join(', ');
            } else if (fieldEl.tagName === 'SELECT') {
                if (fieldEl.value && fieldEl.selectedIndex > -1) {
                    value = fieldEl.options[fieldEl.selectedIndex].text;
                    if (fieldEl.value === 'outro') {
                        const outroInput = document.getElementById(`${fieldEl.id}-outro`);
                        if (outroInput && outroInput.value) value = `Outro: ${outroInput.value}`;
                    }
                }
            } else if (fieldEl.tagName === 'INPUT' || fieldEl.tagName === 'TEXTAREA') {
                value = fieldEl.value;
            }

            if (label && value && value.trim() !== '') {
                fieldsArray.push({ label, value });
            }
        }

        function construirHtmlImpressao(data) {
            let bodyContent = '';
            data.sections.forEach(section => {
                let sectionContent = '';
                section.subsections.forEach(sub => {
                    if (sub.fields.length > 0) {
                        if (sub.title) sectionContent += `<h3>${sub.title}</h3>`;
                        sub.fields.forEach(field => {
                            sectionContent += `<div class="field"><span class="label">${field.label}:</span> <span class="value">${field.value.replace(/\n/g, '<br>')}</span></div>`;
                        });
                    }
                });
                if (sectionContent) bodyContent += `<h2>${section.title}</h2><div class="section-content">${sectionContent}</div>`;
            });

            const placeholder = 'Comece a preencher os campos para gerar o resumo.';
            if (data.summary && data.summary.trim() !== placeholder) {
                bodyContent += `<h2>Resumo da Evolução</h2><div class="summary-content">${data.summary.replace(/\n/g, '<br>')}</div>`;
            }

            return `<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><title>Relatório de Evolução Médica</title><style>body{font-family:Arial,sans-serif;font-size:11px;line-height:1.5;color:#333;margin:20mm;-webkit-print-color-adjust:exact;color-adjust:exact;text-align:justify}.header{text-align:center;border-bottom:2px solid #333;padding-bottom:10px;margin-bottom:15px}.header h1{margin:0;font-size:20px}.patient-info{display:flex;flex-wrap:wrap;justify-content:space-between;margin-bottom:20px;font-size:12px;padding:10px;background-color:#f9f9f9;border-radius:4px}.patient-info span{min-width:200px;margin-bottom:5px}h2{font-size:14px;font-weight:bold;color:#fff;background-color:#334155;padding:6px 10px;margin:24px 0 10px 0;border-radius:3px;page-break-before:auto;page-break-after:avoid}h3{font-size:12px;font-weight:bold;border-bottom:1px solid #ccc;padding-bottom:3px;margin:15px 0 8px 0;page-break-after:avoid}.section-content{page-break-inside:avoid}.field{display:flex;margin-bottom:6px;page-break-inside:avoid}.label{font-weight:bold;min-width:180px;flex-shrink:0;text-align:left}.value{}.summary-content{padding:10px;background-color:#f9f9f9;border-radius:4px;white-space:pre-wrap}</style></head><body><div class="header"><h1>Relatório de Evolução Médica</h1></div><div class="patient-info"><span><strong>Paciente:</strong> ${data.header.nome||'Não informado'}</span><span><strong>Prontuário:</strong> ${data.header.prontuario||'Não informado'}</span><span><strong>Setor:</strong> ${data.header.setor||'Não informado'}</span><span><strong>Leito:</strong> ${data.header.leito||'Não informado'}</span><span><strong>Data:</strong> ${data.header.data}</span><span><strong>Hora:</strong> ${data.header.hora}</span></div>${bodyContent}</body></html>`;
        }

        function construirHtmlFormularioBranco() {
            let bodyContent = '';
            document.querySelectorAll('[data-print-section]').forEach(sectionEl => {
                let sectionContent = '';
                const title = sectionEl.getAttribute('data-print-section');
                const subsections = sectionEl.querySelectorAll('[data-print-subsection]');
                if (subsections.length > 0) {
                    subsections.forEach(subEl => {
                        const subTitle = subEl.getAttribute('data-print-subsection');
                        let subContent = '';
                        subEl.querySelectorAll('.printable').forEach(fieldEl => { subContent += processBlankField(fieldEl); });
                        if (subContent) sectionContent += `<h3>${subTitle}</h3>${subContent}`;
                    });
                } else {
                    sectionEl.querySelectorAll('.printable').forEach(fieldEl => { sectionContent += processBlankField(fieldEl); });
                }
                if (sectionContent) bodyContent += `<h2>${title}</h2><div class="section-content">${sectionContent}</div>`;
            });

            return `<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><title>Formulário de Evolução Médica</title><style>body{font-family:Arial,sans-serif;font-size:11px;line-height:1.6;color:#333;margin:20mm;-webkit-print-color-adjust:exact;color-adjust:exact;text-align:justify}.header{text-align:center;border-bottom:2px solid #333;padding-bottom:10px;margin-bottom:15px}.header h1{margin:0;font-size:20px}.patient-info{display:flex;flex-wrap:wrap;justify-content:space-between;margin-bottom:20px;font-size:12px;row-gap:8px}.patient-info span{flex-basis:48%}h2{font-size:14px;font-weight:bold;color:#fff;background-color:#334155;padding:6px 10px;margin:24px 0 10px 0;border-radius:3px;page-break-before:auto;page-break-after:avoid}h3{font-size:12px;font-weight:bold;border-bottom:1px solid #ccc;padding-bottom:3px;margin:15px 0 8px 0;page-break-after:avoid}.section-content{page-break-inside:avoid}.field{display:flex;align-items:baseline;margin-bottom:12px;page-break-inside:avoid}.label{font-weight:bold;min-width:180px;flex-shrink:0;padding-right:10px;text-align:left}.line{flex-grow:1;border-bottom:1px dotted #888;height:16px}.field-group{margin-bottom:12px;page-break-inside:avoid}.checkbox-options{display:flex;flex-wrap:wrap;gap:15px;margin-top:5px}.checkbox-item{font-size:11px}.textarea-box{height:60px;border:1px dotted #888;border-radius:3px;margin-top:5px}</style></head><body><div class="header"><h1>Formulário de Evolução Médica</h1></div><div class="patient-info"><span><strong>Paciente:</strong> _________________</span><span><strong>Prontuário:</strong> __________</span><span><strong>Setor:</strong> _________________</span><span><strong>Leito:</strong> __________</span></div>${bodyContent}</body></html>`;
        }

        function processBlankField(fieldEl) {
            const labelText = fieldEl.getAttribute('data-print-label');
            if (!labelText || ['Nome do Paciente', 'Prontuário', 'Setor', 'Leito'].includes(labelText)) {
                return ''; // Filters out header fields, which are handled separately
            }
            let html = '';
            const tagName = fieldEl.tagName;
            const dataType = fieldEl.getAttribute('data-print-type');

            if (tagName === 'SELECT') {
                html += `<div class="field-group"><div class="label">${labelText}:</div><div class="checkbox-options">`;
                fieldEl.querySelectorAll('option').forEach(opt => {
                    if (opt.value) html += `<span class="checkbox-item">&#9744; ${opt.text}</span>`;
                });
                html += `</div></div>`;
            } else if (dataType === 'checkbox-group') {
                html += `<div class="field-group"><div class="label">${labelText}:</div><div class="checkbox-options">`;
                fieldEl.querySelectorAll('label span.ml-1').forEach(checkLabel => {
                    html += `<span class="checkbox-item">&#9744; ${checkLabel.innerText.trim()}</span>`;
                });
                html += `</div></div>`;
            } else if (tagName === 'TEXTAREA') {
                html += `<div class="field-group"><div class="label">${labelText}:</div><div class="textarea-box"></div></div>`;
            } else if (tagName === 'INPUT') { // Covers all input types like text, time, etc.
                html += `<div class="field"><span class="label">${labelText}:</span><span class="line"></span></div>`;
            }
            // If none of the above, return empty string, though most printable elements should be covered
            return html;
        }

        function abrirJanelaDeImpressao(html) {
            const oldFrame = document.getElementById('printFrame');
            if (oldFrame) oldFrame.remove();

            const printFrame = document.createElement('iframe');
            printFrame.id = 'printFrame';
            printFrame.style.cssText = 'position:absolute;width:0;height:0;border:0;';
            document.body.appendChild(printFrame);

            const frameDoc = printFrame.contentWindow.document;
            frameDoc.open();
            frameDoc.write(html);
            frameDoc.close();

            printFrame.onload = function() {
                try {
                    printFrame.contentWindow.focus();
                    printFrame.contentWindow.print();
                } catch (e) {
                    console.error("Erro ao imprimir:", e);
                }
            };
        }
    </script>

</body>

</html>
